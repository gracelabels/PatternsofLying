---
title: "Data Cleaning"
author: "Grace Abels"
date: "4/19/2022"
output:
  pdf_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

```{r load packages, warning=FALSE, message=FALSE, echo = FALSE}
library(tidyverse)
library(knitr)
```

## Version 0 - All Unsorted Data

The dataset was pulled by Joel Luther. The dataset includes all entries from Claim Review that were published by sources based in the US. 14 unique fact-checking publishers were included. Included entries were those in which the reviewDate was between Jan 1st, 2016 and June 30th, 2021.

```{r v0 all unsorted, message=FALSE, warning=FALSE}

v0_all_us_unsorted <- read_csv("allUS_unsorted.csv")

v0_all_us_unsorted%>%
  count() %>%
  kable(caption = "All US Claims from ClaimReview 01/01/2016 - 06/30/2021")

v0_all_us_unsorted %>% 
  count(publisher.site)%>%
  kable(caption = "All US Claims from ClaimReview 01/01/2016 - 06/30/2021
        Sorted by Publisher")

```

NEED ASA TO EXPLAIN HOW TO GO FROM VERSION 0 to 1. Politician sort

### Version 1 - Only Political Figures

"We built a small data pipeline that tried to identify, for each claim, whether its uterrer was a person and, if they were, whether they met our definition of a politician. A politician, we decided, was anyone who'd held or run for partisan office, or who'd been hired or appointed by a such a person to serve on a campaign or in a government agency.

We identified human claimants by feeding claimant names in our dataset through an entity recognition API. Given text like ""The Sierra Club"" or ""Bill Murray"", the API tried to detect what it referred to -- e.g. a person or an organization -- letting us label claimants as human.

Next, we tried to categorize human claimants as politicians or non-politicians. To do so, we fed claimants' names through a Wikipedia API. If a given claimant had a Wikipedia article about them, our code checked whether the article contained any ""politician indicators"". For example, if the infobox in an article about a claimant said they'd worked as a politician or political operative, we accepted that as fact and marked them as a politician. Likewise, if in the first few paragraphs of the Wikipedia article, text matched certain keywords (e.g. in a single sentence, the article mentioned its subject""ran"" in an ""election"" or ""work""ed in the""White House""), the code inferred that they, too, were a politician.

Additionally, once the code deduced that a claimant was a politician, it scanned their Wikipedia infobox for reference to their party affiliation, recording it in our dataset. If there was no Wikipedia article about a human claimant, as was occasionally the case for unsuccessful candidates for local office, the data pipeline tried to find a corresponding page for the claimant on Ballotpedia, an online encyclopedia of American politics. If it found one, it searched the page for the same markers looked for on Wikipedia pages, and similarly tried to identify the claimant's party affiliation. When the process above had been completed for each claimant, data collection was finished, and we filtered out all claims in the dataset whose claimants weren't labeled as human politicians. Following data collection, we undertook some light data cleaning. Namely, if we found that a claimant had been affiliated with several political parties, we gave them a party label corresponding to the party they'd identified with when they'd made the claim. In a small number of cases, our code categorized a claimant as a politician but failed to infer their party; those claimants' politician status and party ID were manually reviewed and edited at a later stage but were labelled as unknown_affiliation for the time being. The resulting dataset was of only claims made by politicians and political figures in the US with corresponding parties labeled.

```{r pull v1 data, message=FALSE, warning=FALSE, echo=FALSE}

v1_all_us_polclaims <- read_csv("all_us_pol_claims_updated_sep15.csv")

v1_all_us_polclaims %>%
  count() %>%
  kable(caption = "All Politician Claims (post-filter)")

v1_all_us_polclaims %>% 
  count(publisher.site) %>%
  kable(caption = "All Politician Claims (post-filter)
        Sorted by Publisher")

v1_all_us_polclaims %>% 
 count(claimant_party) %>%
 kable(caption = "All Politician Claims (post-filter)
        Sorted by Party")

```

### Version 2 - 5 Parties

At this stage we noticed that several of the claimant's were assigned non-US political parties suggesting they were not US political figures. At this point, all claims whose party affiliation in claimant_party was not Democratic, Republican, Libertarian, Independent, or unknown_affilition were removed. Version 2 only consists of claims made by political figures belonging to U.S. political parties or ones that we assigned an unknown affiliation. At this time, those with unknown\_ affiliation were left unsorted. We addressed these once we had narrowed down to our smallest size datasets as to minimize hand sorting.

```{r create v2, message=FALSE, warning=FALSE, echo=FALSE}

v2_5parties <- v1_all_us_polclaims %>%
  filter(claimant_party == "Republican"|
           claimant_party == "Democratic"| 
         claimant_party == "Independent"|
         claimant_party == "Libertarian"| 
         claimant_party == "unknown_affiliation")

v2_5parties %>%
  count() %>%
  kable(caption = "All Claims in 5 Parties")

v2_5parties %>%
  count(publisher.site) %>%
  kable(caption = "All Claims in 5 Parties
        Sorted by Publisher")

v2_5parties %>%
  count(claimant_party) %>%
  kable(caption = "All Claims in 5 Parties
        Sorted by Party")

```

### Version 3 - Deduped

At this step we filtered out duplicate claims. These were claims in which both the url and and text (previously thought title but it wasnt) of the claim were identical. The first appearance of each claim remained in the dataset, other were removed. This resulted in a database of 7,360 unique claims.

```{r dedupe for v3, message=FALSE, warning=FALSE, echo=FALSE}

v3_deduped <- v2_5parties %>%
  distinct(url, text, .keep_all = TRUE)

```

```{r display v3 results, message=FALSE, warning=FALSE, echo=FALSE}

v3_deduped %>%
  count() %>%
  kable(caption = "All Claims in 5 Parties - Deduped")

v3_deduped %>%
  count(publisher.site) %>%
  kable(caption = "All Claims in 5 Parties - Deduped and
        Sorted by Publisher")

v3_deduped %>%
  count(claimant_party) %>%
  kable(caption = "All Claims in 5 Parties - Deduped and
        Sorted by Party")

```

### Version 4 - Dejunked

For a final clean up before sorting by publisher and removing Trump, a member of our research team **manually identified 23 false positive rows** that either listed multiple claimants or had a false positive non-human claimant (e.g. "Donald Trump's campaign"). Those 23 claims were manually removed.

```{r manual removal for v4, message=FALSE, warning=FALSE, echo=FALSE}
v4_dejunked <- v3_deduped %>%
  filter(claimant != "Donald Trump For Prison") %>%
  filter(claimant != "Lauren Boebert; Rudy Giuliani") %>%
  filter(claimant != "Rick Scott's Starbuck's heckler") %>%
  filter(claimant != "Americans United for Change") %>%
  filter(claimant != "Consumers for Smart Solar") %>%
  filter(claimant != "Greg Gianforte's campaign") %>%
  filter(claimant != "Vietnam Veterans Against John McCain") %>%
  filter(claimant != "President Trump's lawyers") %>%
  filter(claimant != "Robin Vos and Scott Fitzgerald") %>%
  filter(claimant != "Robin Vos; Scott Fitzgerald") %>%
  filter(claimant != "Donald Trump 2020 Voters") %>%
  filter(claimant != "Michael Bloomberg; Joe Biden; Hillary Clinton; Adam Schiff") %>%
  filter(claimant != "Donald Trump and Mike Pence") %>%
  filter(claimant != "Bill DeBlasio and Brian Kemp") %>%
  filter(claimant != "John Roberts; Fox News correspondent") %>%
  filter(claimant != "The Trump campaign") %>%
  filter(claimant != "Sen. Ted Cruz (R-Texas) and Rep. Mark Meadows (R-N.C.)") %>%
  filter(claimant != "Keith Ellison spokesman") %>%
  filter(claimant != "Donald Trump ad") %>%
  filter(claimant != "Kamala Harris for the People") %>%
  filter(claimant != "Don Bolduc campaign") %>%
  filter(claimant != "Donald Trump campaign") %>%
  filter(claimant != "Joe Biden campaign") 

```

```{r tables for v4, message=FALSE, warning=FALSE, echo=FALSE}
v4_dejunked %>%
  count() %>%
  kable(caption = "All Claims in 5 Parties - Deduped and Dejunked")

v4_dejunked%>%
  count(publisher.site) %>%
  kable(caption = "All Claims in 5 Parties - Deduped and Dejunked
        Sorted by Publisher")

v4_dejunked %>%
  count(claimant_party) %>%
  kable(caption = "All Claims in 5 Parties - Deduped and Dejunked
        Sorted by Party")

```

At this stage, the dataset of 7,337 claims had been cleaned of irrelevant and redundant data removed. The dataset that remains consists of claims that were made by U.S. political figures, and fact-checked by one of 13 U.S based publishers. At this stage, we began working with each publisher dataset separately. Only four publishers at this stage had enough claims to move forward: FactCheck.Org, The New Your Times, PolitiFact, and The Washington Post. Go to the next sheet for our next step.

### Version 5 - Split into Publisher data

At this point we began looking at the makeup of each publisher individually. Based on the number of total fact checks, we selected four publishers to analyze in the next step: PolitiFact, The Washington Post, FactCheck.Org, and The New York Times. This resulted in four individual datasets, one per publisher, each denoted as v5.

```{r create v5, message=FALSE, warning=FALSE, echo=FALSE}
v5_pf <- v4_dejunked %>%
  filter(publisher.site == "politifact.com")

v5_wapo <- v4_dejunked %>%
  filter(publisher.site == "washingtonpost.com")

v5_fc <- v4_dejunked %>%
  filter(publisher.site == "factcheck.org")

v5_nyt <- v4_dejunked %>%
  filter(publisher.site == "nytimes.com")
```

```{r v5 tables, message=FALSE, warning=FALSE, echo=FALSE }
v5_pf %>%
  count() %>%
  kable(caption = "Politifact - All Claims in 5 Parties")

v5_pf %>%
  count(claimant_party) %>%
  kable(caption = "Politifact - All Claims in 5 Parties - 
        Sorted by Party")
v5_wapo %>%
  count() %>%
  kable(caption = "Washington Post - All Claims in 5 Parties")

v5_wapo %>%
  count(claimant_party) %>%
  kable(caption = "Washington Post - All Claims in 5 Parties - 
        Sorted by Party")

v5_fc %>%
  count() %>%
  kable(caption = "FactCheck.Org - All Claims in 5 Parties")

v5_fc %>%
  count(claimant_party) %>%
  kable(caption = "FactCheck.Org - All Claims in 5 Parties - 
        Sorted by Party")
v5_nyt %>%
  count() %>%
  kable(caption = "New York Times - All Claims in 5 Parties") 

v5_nyt %>%
  count(claimant_party) %>%
  kable(caption = "New York Times - All Claims in 5 Parties -  
        Sorted by Party")

```

### Version 6 - Removing Trump

We made the decision to remove Donald Trump entirely from this dataset. To do so, we first identified all the different iterations of his name within the `claimant` column. We could not simply remove all claimants whose names included Trump, because under our definitions, his daughter Ivanka Trump was a politician. The code determining these iterations is shown below.

```{r find trump names, message=FALSE, warning=FALSE, echo=FALSE}

elim_trump <- v4_dejunked %>%
  filter(publisher.site == "politifact.com" |
           publisher.site ==  "washingtonpost.com" |
           publisher.site == "factcheck.org" |
           publisher.site == "nytimes.com")

elim_trump %>%
  filter(grepl('Trump|trump', claimant)) %>%
  group_by(claimant) %>%
  count() %>%
  kable(caption = "Names including 'Trump'")

```

With these four versions of Trump's name, we manually removed them from each V5 dataset. This created our V6 dataset without Trump for each publisher.

```{r create v6, message=FALSE, warning=FALSE, echo=FALSE}

v6_pf <- v5_pf %>%
  filter(claimant != "Donald J. Trump") %>%
  filter(claimant !=  "Donald trump") %>%
  filter(claimant != "Donald Trump") %>%
  filter(claimant != "President Donald J. Trump")

v6_wapo <- v5_wapo %>%
  filter(claimant != "Donald J. Trump") %>%
  filter(claimant !=  "Donald trump") %>%
  filter(claimant != "Donald Trump") %>%
  filter(claimant != "President Donald J. Trump")

v6_fc <- v5_fc %>%
  filter(claimant != "Donald J. Trump") %>%
  filter(claimant !=  "Donald trump") %>%
  filter(claimant != "Donald Trump") %>%
  filter(claimant != "President Donald J. Trump")

v6_nyt <- v5_nyt %>%
  filter(claimant != "Donald J. Trump") %>%
  filter(claimant !=  "Donald trump") %>%
  filter(claimant != "Donald Trump") %>%
  filter(claimant != "President Donald J. Trump")

```

```{r v6 tables, message=FALSE, warning=FALSE, echo=FALSE}
v6_pf %>%
  count() %>%
  kable(caption = "Politifact - Without Trump")

v6_pf %>%
  count(claimant_party) %>%
  kable(caption = "Politifact - Without Trump - 
        Sorted by Party")
v6_wapo %>%
  count() %>%
  kable(caption = "Washington Post - Without Trump")

v6_wapo %>%
  count(claimant_party) %>%
  kable(caption = "Washington Post - Without Trump - 
        Sorted by Party")

v6_fc %>%
  count() %>%
  kable(caption = "FactCheck.Org - Without Trump")

v6_fc %>%
  count(claimant_party) %>%
  kable(caption = "FactCheck.Org - Without Trump - 
        Sorted by Party")
v6_nyt %>%
  count() %>%
  kable(caption = "New York Times - Without Trump") 

v6_nyt %>%
  count(claimant_party) %>%
  kable(caption = "New York Times - Without Trump -  
        Sorted by Party")
```

### Version 7 - Sorting Unknown Affiliation

After we had the data divided into its smaller publisher sub-sets, and removed Trump from the data, our next step was to address anomalies in the claimant_party section. The code that was used to assign party affiliations scraped Wikipedia data and Ballotpedia for politicians and party affiliations. For about 100 different claims, the claimant was identified as a political figure but a party could not be found. They were labeled unknown_affiliation. We did not make an attempt to sort these previously, because there were simply too many. However, at this stage we have narrowed down to the data we plan to use. Therefore our next step was to manually assign party affiliations to the unknown_affiliation claims.

This was done by pulling the claims labeled unknown_affiliation for each publisher. Only the fields using the name of the claimant, and occasionally the url for the fact-check itself if ambiguous, claimants were either

1. Assigned a party (Democrat, Republican, Independent, Libertarian)
2. Marked to be removed from the dataset because they were not a political figure.

For all those assigned a party, the cell to the left denotes why and provides a link to the source used to make that determination. If someone changed parties, the claim date was noted.

NOTE: If a claimant served in an administration and spoke on behalf of that administration or politician, they were considered a political figure and assigned the affiliation of the administration or politician they served/spoke on behalf of. This applied to appointed cabinet members, political officials, and lawyers representing politicians. Political commentators, activists, and celebrities were removed and not considered political figures

```{r v7 substitutions, message=FALSE, warning=FALSE, echo=FALSE}
v7_fc <- v6_fc %>%
  filter(claimant != "Hal Turner") %>%
  filter(claimant != "Sean P. Conley")
v7_fc$claimant_party[v7_fc$claimant == "Brett Giroir"] <- "Republican"
v7_fc$claimant_party[v7_fc$claimant == "Dr. Deborah Birx"] <- "Republican"
v7_fc$claimant_party[v7_fc$claimant == "John Kelly"] <- "Republican"
v7_fc$claimant_party[v7_fc$claimant == "Kevin K. McAleenan"] <- "Republican"
v7_fc$claimant_party[v7_fc$claimant == "Kirstjen Nielsen"] <- "Republican"
v7_fc$claimant_party[v7_fc$claimant == "Loretta Lynch"] <- "Democratic"
v7_fc$claimant_party[v7_fc$claimant == "Sidney Powell"] <- "Republican"
v7_fc$claimant_party[v7_fc$claimant == "Steve Cortes"] <- "Republican"

v7_fc %>%
  count(claimant_party) %>%
  kable(caption = "Factcheck.org by Claimant Party, 
        without Unknown Affiliation")

v7_nyt <- v6_nyt
v7_nyt$claimant_party[v7_nyt$claimant == "Sidney Powell"] <- "Republican"
v7_nyt$claimant_party[v7_nyt$claimant == "Jesse Binnall"] <- "Republican"

v7_nyt %>%
  count(claimant_party) %>%
  kable(caption = "New York Times by Claimant Party, 
        without Unknown Affiliation")

v7_pf <- v6_pf %>%
  filter(claimant != "Ashley Smith") %>%
  filter(claimant != "Bill Maher") %>%
  filter(claimant != "Bono") %>%
  filter(claimant != "Brit Hume") %>%
  filter(claimant != "Charles Ramsey") %>%
  filter(claimant != "Clay Aiken") %>%
  filter(claimant != "Daniel Kelly") %>%
  filter(claimant != "David Martin") %>%
  filter(claimant != "Edward Flynn") %>%
  filter(claimant != "Erin Burnett") %>%
  filter(claimant != "Giffords") %>%
  filter(claimant != "Hal Turner") %>%
  filter(claimant != "J. Christian Adams") %>%
  filter(claimant != "Jake Tapper") %>%
  filter(claimant != "James Hauser") %>%
  filter(claimant != "John Patrick") %>%
  filter(claimant != "Kevin Downing") %>%
  filter(claimant != "Lawrence O'Donnell") %>%
  filter(claimant != "Lisa Moore") %>%
  filter(claimant != "Maria Bartiromo") %>%
  filter(claimant != "Mark Levin") %>%
  filter(claimant != "Michael Screnock") %>%
  filter(claimant != "Mike Crute") %>%
  filter(claimant != "Nicholas Burns") %>%
  filter(claimant != "Ray Cross") %>%
  filter(claimant != "Robert Sanborn") %>%
  filter(claimant != "Shelley Grogan")
v7_pf$claimant_party[v7_pf$claimant == "Alejandro Mayorkas"] <- "Democratic"
v7_pf$claimant_party[v7_pf$claimant == "Alexander Strenger"] <- "Independent"
v7_pf$claimant_party[v7_pf$claimant == "Beth Parlato"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Bob Donovan"] <- "Independent"
v7_pf$claimant_party[v7_pf$claimant == "Bob Spindell"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Brett Giroir"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Brett McGurk"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Charles Francis"] <- "Independent"
v7_pf$claimant_party[v7_pf$claimant == "Chris Meagher"] <- "Democratic"
v7_pf$claimant_party[v7_pf$claimant == "George Papadopoulos"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "H.R. McMaster"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Jeffrey Zients"] <- "Democratic"
v7_pf$claimant_party[v7_pf$claimant == "Jesse Kremer"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "John Kelly"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "John Kirby"] <- "Democratic"
v7_pf$claimant_party[v7_pf$claimant == "Kirstjen Nielsen"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Loretta Lynch"] <- "Democratic"
v7_pf$claimant_party[v7_pf$claimant == "Louis Marinelli"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Lowell Holtz"] <- "Independent"
###THIS IS A DUPLICATE CLAIM
v7_pf$claimant_party[v7_pf$claimant == "Marc Butler"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Michael Long"] <- "Independent"
v7_pf$claimant_party[v7_pf$claimant == "Mike Collier"] <- "Democratic"
v7_pf$claimant_party[v7_pf$claimant == "Nate McMurray"] <- "Democratic"
v7_pf$claimant_party[v7_pf$claimant == "Paul Maner"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Ryan Frazier"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Scott Dawson"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Scott Jones"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Sidney Powell"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "State representatives"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Steve Cortes"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "Todd Wilcox"] <- "Republican"
v7_pf$claimant_party[v7_pf$claimant == "William Taylor"] <- "Independent"

v7_pf %>%
  count(claimant_party) %>%
  kable(caption = "PolitiFact by Claimant Party, 
        without Unknown Affiliation")

v7_wapo <- v6_wapo %>%
  filter(claimant != "Anthony Fauci") %>%
  filter(claimant != "Jim Acosta")
v7_wapo$claimant_party[v7_wapo$claimant == "Charmaine Yoest"] <- "Republican"
v7_wapo$claimant_party[v7_wapo$claimant == "H.R. McMaster"] <- "Republican"
v7_wapo$claimant_party[v7_wapo$claimant == "Jim Mattis"] <- "Republican"
v7_wapo$claimant_party[v7_wapo$claimant == "Kirstjen Nielsen"] <- "Republican"
v7_wapo$claimant_party[v7_wapo$claimant == "Loretta Lynch"] <- "Democratic"
v7_wapo$claimant_party[v7_wapo$claimant == "Steve Cortes"] <- "Republican"
v7_wapo$claimant_party[v7_wapo$claimant == "Vanita Gupta"] <- "Democratic"

v7_wapo %>%
  count(claimant_party) %>%
  kable(caption = "Washington Post by Claimant Party, 
        without Unknown Affiliation")
```


### Version 8 - Removing Libertarian and Independents

```{r v8, message=FALSE, warning=FALSE, echo=FALSE}
v8_fc <- v7_fc %>%
  filter(claimant_party == "Democratic" |
           claimant_party == "Republican")

v8_fc %>%
  count(claimant_party) %>%
  kable(caption = "Factcheck.org by Claimant Party")

v8_nyt <- v7_nyt %>%
  filter(claimant_party == "Democratic" |
           claimant_party == "Republican")

v8_nyt %>%
  count(claimant_party) %>%
  kable(caption = "New York Times by Claimant Party")

v8_pf <- v7_pf %>%
  filter(claimant_party == "Democratic" |
           claimant_party == "Republican")

v8_pf %>%
  count(claimant_party) %>%
  kable(caption = "PolitiFact by Claimant Party")

v8_wapo <- v7_wapo %>%
  filter(claimant_party == "Democratic" |
           claimant_party == "Republican")

v8_wapo %>%
  count(claimant_party) %>%
  kable(caption = "Washington Post by Claimant Party")
```


