---
title: "PolitiFact Analysis"
author: "Sofia Bliss-Carrascoas"
date: "9/28/2022"
output:
  pdf_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

```{r load packages, warning=FALSE, message=FALSE, echo = FALSE}
library(tidyverse)
library(knitr)
library(tibble)
```

```{r color scale and ordering, warning=FALSE, message=FALSE, echo = FALSE }
pf_mega <- read_csv("pf_mega_location.csv")

truenesscolors = c("#FF0000", "#FF872C", "#FAB733", "#FDE64B", "#ACB334", "#69B34C")

pf_mega$textualRating <- factor(pf_mega$textualRating, 
                              levels = c("Pants on Fire", 
                                         "False", 
                                         "Mostly False", 
                                         "Half True", 
                                         "Mostly True", 
                                         "True"))
```

```{r fix tagging error,  warning=FALSE, message=FALSE, echo = FALSE}
pf_mega$`Government Operations`[pf_mega$...1 == "3990"] <- "TRUE"
#This was a mistagged claim that we manually changed. 
```

Having cleaning, sorted, and tagged all of our data, we conducted some initial data analysis to answer some of our research questions.

### Which Party Lies More?

Our first research question was relatively simple. Which party lies more? While it is an impossible question to answer definitively, we decided to look at each rating tier and see the breakdown by party to get a sense of which party receives more false ratings.

```{r pivot table for textual rating,  warning=FALSE, message=FALSE, echo = FALSE}
pf_mega %>%
  count(claimant_party, textualRating) %>%
    pivot_wider(id_cols = c(textualRating),
              names_from = claimant_party,
              values_from = n,
              values_fill = 0) %>%
  mutate(Democratic = as.numeric(Democratic),
         Republican = as.numeric(Republican)) %>%
   mutate(Total = rowSums(across(where(is.numeric)))) %>%
  kable(caption = "Claims by Party Sorted by Rating")
```

```{r plot of party counts,  warning=FALSE, message=FALSE, echo = FALSE}
ggplot(pf_mega, aes(x = textualRating, fill = claimant_party)) +
 geom_bar() +
  scale_fill_manual(values = c("blue2", "red3")) +
  labs(title = "Ratings Counts by Party",
       x = "Rating",
       y = "Total Claims",
       fill = "Party of Claimant")
```

To account for the different samples sizes, we also viewed the data proportionally. Here we can see that Republican claimants are responsible for over 76.9% of the Pants on Fire claims, 66% of False claims, and 55.2% of Mostly False claims. Democrats have a majority of truthful claims responsible for 57% of the Half True claims, 67.6% of the Mostly True claims, and 66.7% of True claims.

```{r plot of party counts with fill,  warning=FALSE, message=FALSE, echo = FALSE}
ggplot(pf_mega, aes(x = textualRating, fill = claimant_party)) +
 geom_bar(position = "fill") +
  scale_fill_manual( values = c("blue2", "red3")) +
  labs(title = "Ratings Proportions by Party",
       x = "Rating",
       y = "Proportion",
       fill = "Party of Claimant")

```

### Severity of Claims -- by Party

Our second research question was, does one party lie worse. For this, we looking within each party's claims and reviewed the distribution of ratings.

```{r severity graph,  warning=FALSE, message=FALSE, echo = FALSE}
ggplot(pf_mega, aes(x = claimant_party, fill = textualRating)) +
         geom_bar(position = "fill") +
  labs(title = "Proportion of Rating by Party",
       x = "Claims by Party",
       fill = "Rating", y = "Proportion") +
  scale_fill_manual(values = truenesscolors)

```

Here we can see that 7.9% of all Republican claims are rated Pants on Fire as opposed to 2.2% of Democratic claims. 26.2 % and 22.6% of Republican claims are rated False and Mostly False respectively. 12.4% and 16.9% of Democratic claims are rated False and Mostly False.

Democrats also have a greater proportion of their claims rated True and Mostly True. To see a full percentage breakdown, review the table below.

```{r percentage severity table, message=FALSE, warning=FALSE, echo=FALSE}
dems <- pf_mega %>%
  filter(claimant_party == "Democratic")
dems <- dems %>%
  group_by(textualRating) %>%
  summarize(count = n()) %>%
  mutate(Democratic = 100*(count/nrow(dems))) %>%
  select(textualRating, Democratic)

reps <- pf_mega %>%
  filter(claimant_party == "Republican")
reps <- reps %>%
  group_by(textualRating) %>%
  summarize(count = n()) %>%
  mutate(Republican = 100*(count/nrow(reps))) %>%
  select(textualRating, Republican)

total <- pf_mega %>%
  group_by(textualRating) %>%
  summarize(count = n()) %>%
  mutate(Total = 100*(count/nrow(pf_mega))) %>%
  select(textualRating, Total)

textRatingcounts <- full_join(dems, reps, by = "textualRating") %>%
  full_join(total, by = "textualRating")

textRatingcounts %>%
  select(textualRating, Democratic, Republican, Total) %>%
  kable(digits = 1, caption = "Percentage of Claims by Textual Rating")
```

### What do they Lie About?

Next we reviewed the distribution of our subject tags.

Listed in our table below is the number of claims tagged with each macro tag, by party and in total. WRITE REST ABOUT OBSERVATIOSN

```{r, subject tag table macro,  warning=FALSE, message=FALSE, echo = FALSE}
binarymacro <- pf_mega %>%
  mutate(Fear = case_when(Fear == TRUE ~ 1,
         Fear == FALSE ~ 0)) %>%
  mutate(Legislation = case_when(Legislation == TRUE ~ 1,
         Legislation == FALSE ~ 0)) %>%
  mutate(`Self/Personal Record` = case_when(`Self/Personal Record` == TRUE ~ 1, 
         `Self/Personal Record` == FALSE ~ 0)) %>%
  mutate(`Opponent/Opponent's Record` = 
          case_when(`Opponent/Opponent's Record` == TRUE ~ 1, 
         `Opponent/Opponent's Record` == FALSE ~ 0)) %>%
  filter(!is.na(Fear)) 

macro_tibble <- binarymacro %>%
  group_by(claimant_party) %>%
  summarize(Fear = sum(Fear),
            Legislation = sum(Legislation),
            `Self/Personal Record` = sum(`Self/Personal Record`),
            `Opponent/Opponent's Record` = sum(`Opponent/Opponent's Record`))

macro_tibble <- t(macro_tibble)

macro_tibble <- janitor::row_to_names(macro_tibble, 1) 

macro_tibble <- base::data.frame(macro_tibble)

macro_tibble <- macro_tibble %>% 
  mutate(Democratic = as.numeric(Democratic),
         Republican = as.numeric(Republican)) %>%
   mutate(Total = rowSums(across(where(is.numeric))))

macro_tibble %>% 
  kable(caption = "Macro Subject Tag Counts")

```

We did the same with our micro tags. In addition to giving raw counts, we calculated what percentage o

```{r subject tag table micro, message= FALSE, warning= FALSE, echo= FALSE }
binarymicro <- pf_mega %>%
  mutate(`National and State Macroeconomic Issues` = 
          case_when(`National and State Macroeconomic Issues` == TRUE ~ 1,
          `National and State Macroeconomic Issues` == FALSE ~ 0)) %>%
  mutate(`Economic Well-Being and Domestic Commerce` = 
          case_when(`Economic Well-Being and Domestic Commerce` == TRUE ~ 1,
         `Economic Well-Being and Domestic Commerce` == FALSE ~ 0)) %>%
   mutate(`Labor and Employment` = case_when(`Labor and Employment` == TRUE ~ 1,
          `Labor and Employment` == FALSE ~ 0)) %>%
   mutate(`Foreign Trade` = case_when(`Foreign Trade` == TRUE ~ 1,
          `Foreign Trade` == FALSE ~ 0)) %>%
   mutate(`Taxes` = case_when(`Taxes` == TRUE ~ 1,
          `Taxes` == FALSE ~ 0)) %>%
   mutate(`Civil Rights, Minority Issues, and Civil Liberties` = 
          case_when(`Civil Rights, Minority Issues, and Civil Liberties` == TRUE ~ 1,
          `Civil Rights, Minority Issues, and Civil Liberties` == FALSE ~ 0)) %>%
   mutate(`Immigration and Refugee Issues` = 
          case_when(`Immigration and Refugee Issues` == TRUE ~ 1,
          `Immigration and Refugee Issues` == FALSE ~ 0)) %>%
   mutate(`LGBTQ` = case_when(`LGBTQ` == TRUE ~ 1,
          `LGBTQ` == FALSE ~ 0)) %>% 
   mutate(`Race` = case_when(`Race` == TRUE ~ 1,
          `Race` == FALSE ~ 0)) %>%
   mutate(`Religion` = case_when(`Religion` == TRUE ~ 1,
          `Religion` == FALSE ~ 0)) %>%
   mutate(`Women` = case_when(`Women` == TRUE ~ 1,
          `Women` == FALSE ~ 0)) %>%
   mutate(`Health (non-care)` = case_when(`Health (non-care)` == TRUE ~ 1,
          `Health (non-care)` == FALSE ~ 0)) %>%
   mutate(`Social Welfare` = case_when(`Social Welfare` == TRUE ~ 1,
          `Social Welfare` == FALSE ~ 0)) %>%
   mutate(`Education` = case_when(`Education` == TRUE ~ 1,
          `Education` == FALSE ~ 0)) %>%
   mutate(`Abortion` = case_when(`Abortion` == TRUE ~ 1,
          `Abortion` == FALSE ~ 0)) %>%
   mutate(`Healthcare` = case_when(`Healthcare` == TRUE ~ 1,
          `Healthcare` == FALSE ~ 0)) %>%
   mutate(`Government Operations` = case_when(`Government Operations` == TRUE ~ 1,
          `Government Operations` == FALSE ~ 0)) %>%
   mutate(`Defense/Military` = case_when(`Defense/Military` == TRUE ~ 1,
          `Defense/Military` == FALSE ~ 0)) %>%
   mutate(`International_affairs and Foreign Aid` = 
           case_when(`International_affairs and Foreign Aid` == TRUE ~ 1,
          `International_affairs and Foreign Aid` == FALSE ~ 0)) %>%
   mutate(`Voting/Elections` = case_when(`Voting/Elections` == TRUE ~ 1,
          `Voting/Elections` == FALSE ~ 0)) %>%
   mutate(`Agriculture` = case_when(`Agriculture` == TRUE ~ 1,
          `Agriculture` == FALSE ~ 0)) %>%
   mutate(`Environment` = case_when(`Environment` == TRUE ~ 1,
          `Environment` == FALSE ~ 0)) %>%
   mutate(`Energy` = case_when(`Energy` == TRUE ~ 1,
          `Energy` == FALSE ~ 0)) %>%
   mutate(`Transportation` = case_when(`Transportation` == TRUE ~ 1,
          `Transportation` == FALSE ~ 0)) %>%
   mutate(`Community Development and Housing` = 
           case_when(`Community Development and Housing` == TRUE ~ 1,
          `Community Development and Housing` == FALSE ~ 0)) %>%
   mutate(`Technology Science Space` = 
           case_when(`Technology Science Space` == TRUE ~ 1,
          `Technology Science Space` == FALSE ~ 0)) %>%
   mutate(`Media and Communications` = 
           case_when(`Media and Communications` == TRUE ~ 1,
          `Media and Communications` == FALSE ~ 0)) %>%
   mutate(`Law and Crime and Policing` = 
           case_when(`Law and Crime and Policing` == TRUE ~ 1,
          `Law and Crime and Policing` == FALSE ~ 0)) %>%
   mutate(`Terrorism` = case_when(`Terrorism` == TRUE ~ 1,
          `Terrorism` == FALSE ~ 0)) %>%
   mutate(`Guns` = case_when(`Guns` == TRUE ~ 1,
          `Guns` == FALSE ~ 0)) %>%
   mutate(`History` = case_when(`History` == TRUE ~ 1,
          `History` == FALSE ~ 0)) %>%
   mutate(`Record/Candidate Biography/ Campaigns and Personal Behavior` = 
      case_when(`Record/Candidate Biography/ Campaigns and Personal Behavior` == TRUE ~ 1,
          `Record/Candidate Biography/ Campaigns and Personal Behavior` == FALSE ~ 0)) %>%
  filter(!is.na(`Foreign Trade`)) 

micro_tibble_base <- binarymicro %>%
  group_by(claimant_party) %>%
  summarize( `National and State Macroeconomic Issues` = 
              sum(`National and State Macroeconomic Issues`),
             `Economic Well-Being and Domestic Commerce` = 
              sum(`Economic Well-Being and Domestic Commerce`),
             `Labor and Employment` = sum(`Labor and Employment`),
             `Foreign Trade` = sum(`Foreign Trade`),
             `Civil Rights, Minority Issues, and Civil Liberties` =
              sum(`Civil Rights, Minority Issues, and Civil Liberties`),
             `Immigration and Refugee Issues` = sum(`Immigration and Refugee Issues`),
             `LGBTQ` = sum(`LGBTQ`),
             `Race` = sum(`Race`),
             `Religion` = sum(`Religion`),
             `Women` = sum(`Women`),
             `Health (non-care)` = sum(`Health (non-care)`),
             `Social Welfare` = sum(`Social Welfare`),
             `Education` = sum(`Education`),
             `Abortion` = sum(`Abortion`),
             `Healthcare` = sum(`Healthcare`),
             `Government Operations` = sum(`Government Operations`),
             `Defense/Military` = sum(`Defense/Military`),
             `International_affairs and Foreign Aid` =
              sum(`International_affairs and Foreign Aid`),
             `Voting/Elections` = sum(`Voting/Elections`),
             `Agriculture` = sum(`Agriculture`),
             `Environment` = sum(`Environment`),
             `Energy` = sum(`Energy`),
             `Transportation` = sum(`Transportation`),
              `Taxes` = sum(`Taxes`),
             `Community Development and Housing` = 
              sum(`Community Development and Housing`),
             `Technology Science Space` = sum(`Technology Science Space`),
             `Media and Communications` = sum(`Media and Communications`),
             `Law and Crime and Policing` = sum(`Law and Crime and Policing`),
             `Terrorism` = sum(`Terrorism`),
             `Guns` = sum(`Guns`),
             `History` = sum(`History`),
             `Record/Candidate Biography/ Campaigns and Personal Behavior` =
              sum(`Record/Candidate Biography/ Campaigns and Personal Behavior`))

micro_tibble_base <- t(micro_tibble_base)

micro_tibble_base <- janitor::row_to_names(micro_tibble_base, 1) 

micro_tibble_base <- base::data.frame(micro_tibble_base) %>% 
  mutate(Democratic = as.numeric(Democratic),
         Republican = as.numeric(Republican)) 

micro_tibble_base$MicroTag <- row.names(micro_tibble_base)

microreps <- micro_tibble_base %>%
  select(-Democratic) %>%
  mutate(Republican = as.numeric(Republican))
microdems <- micro_tibble_base %>%
  select(-Republican) %>%
  mutate(Democratic = as.numeric(Democratic))

falseRep <- pf_mega %>%
  filter(claimant_party == "Republican") %>%
  filter(textualRating == "Pants on Fire" |
           textualRating == "False" |
           textualRating == "Mostly False") %>%
  count()

falseDem <- pf_mega %>%
  filter(claimant_party == "Democratic") %>%
  filter(textualRating == "Pants on Fire" |
           textualRating == "False" |
           textualRating == "Mostly False") %>%
  count()

microreps$RepublicanPercentage <- 100*(microreps$Republican/as.numeric(falseRep))
microdems$DemocraticPercentage <- 100*(microdems$Democratic/as.numeric(falseDem))

micro_tibble <- full_join(micro_tibble_base, microdems, by = c("Democratic", "MicroTag")) %>%
  full_join(microreps, by = c("Republican", "MicroTag"))

micro_tibble$TotalCount <- micro_tibble$Democratic + micro_tibble$Republican
micro_tibble$PercentDisparity <- 
  (micro_tibble$RepublicanPercentage - micro_tibble$DemocraticPercentage)

micro_tibble <- micro_tibble[, c("MicroTag", 
                                 "Democratic", 
                                 "Republican", 
                                 "TotalCount", 
                                 "DemocraticPercentage", 
                                 "RepublicanPercentage", 
                                 "PercentDisparity")]

micro_tibble %>%
  arrange(PercentDisparity) %>%
  kable(caption = "Microtag Subject Counts and Percentages by Party",
        digits = 2)
```
